## This model is an active work in progress. Detailed ReadMe and tutorial coming soon! Treat this version as an alpha release for limited external testing by very curious users. 

### Brief overview, to be updated/expanded later: 
This is a thermal model for planetary surfaces designed to compute surface temperature as a function of the material properties of the subsurface. 
The key novelty is the addition of radiative transfer solver cores. This shatters the normal approximation in thermal models where the surface of the planetary soil (regolith) is a completely opaque boundary with an effective albedo and emissivity. In reality, granular regolith is highly multi-faceted and the surface can be viewed as semi-transparent under many circumstances. This affects how incoming energy (e.g., sunlight) and outgoing energy (e.g., thermal emission) pass across that boundary, affecting the thermal evolution of the system as well as what the observer actually "sees" from different angles. It is this phenomenon that is thought to be responsible, for example, for shifts in the thermal emissivity spectra of the Lunar surface under vacuum conditions as compared to measurements on Earth at ambient pressures. Some of the incoming sunlight is able to pass into the subsurface, being absorbed by deeper regolith layers. Conversely, thermal emisssion doesn't just arise at the surface but also from the subsurface. The resulting radiance spectrum is thus constructed of emission from regolith layers that are at different temperatures, producing changes in the spectral shape. 

The model core utilizes the finite difference method (implicit Euler method) to solve the time-dependent heat diffusion equation. Nothing new there. 
Two radiative transfer solver options are available: 'hapke' or 'disort', which can be turned on or off. At each time step, the radiative fluxes are computed using hapke or disort based on boundary conditions (e.g., incoming sunlight beam, diffuse visible or thermal fluxes, reflections or emission from a bottom boundary), the temperature profile, and the optical properties of the regolith column (which may vary with depth). The resulting flux divergence is then applied as a source term to the heat equation, and then the model advances to the next step and the process repeats.  
1. The Hapke option makes use of the 2-stream approximation by Bruce Hapke, as described in his 1996 papers, Hale and Hapke (2002), and in Hapke's book. I have written a custom implementation of his equations, with the heaviest computational lift consisting of a boundary value problem that is solved with a single tridiagonal matrix inversion. The Hapke model is currently only written to work in two parallel broadband regions (visible and thermal), as described in the above-mentioned papers. 
2. The DISORT option makes use of the storied and heavily used DISORT discrete ordinate radiative transfer atmospheric model (see publications by Stamnes et al. for details) by calling the pydisort library (PyTorch wrapper for disort in C). This model is far more powerful and in theory can be nearly "perfectly" accurate if you use enough streams. The model can be fed an arbitrary number of wavelength bands across whatever range the user desires, as long as the corresponding optical constants are also provided (therein usually lies the rub).

DISORT can be run in **three modes**: 'two_wave' which is like the Hapke model (broadband thermal, broadband visible spectrum), 'multi_wave' where the user must provide input files for optical constants, solar inputs, etc. as a function of wavenumber across whatever range they desire, and 'hybrid' which is like a combination mode where the visible spectrum is broadband (single user-provided optical constants: single scattering albedo, extinction coefficient, and scattering asymmetry parameters) and the thermal wavelengths are multi-wave, requiring an input file for those coefficients as a function of wavenumber.
Normally, I use two-wave to run the thermal evolution (it is fastest), then switch to hybrid for computing spectra from the resulting temperature profiles as a function of time of day and observer emission/azimuth angle. 

Initial tests under lunar conditions show that the hapke and disort implementations are in very **good agreement** (<1 K) when disort is set to only have 2 streams. However, when the number of streams is increased (at least 4 recommended for thermal evolution), larger discrepancies arise (up to ~5 K), which may be taken as evidence that the hapke approximation (or any 2-stream approximation) will only get you to within about 5 K of "reality." Far more tests are needed though to fine-tune those numbers. 

The model also has built-in support for **rough surfaces** (including ray-tracing calculations of shadowing, multiple-scattering, and self-heating). Currently, only a hemispherical crater is supported as a "roughness element," but other types of surface roughness should be added in the future, including functions to generate those surfaces. 

**CAUTION**!!! Given that the code is still under heavy active development (currently on temporary pause as we wait for more funding), many features may be incomplete and/or broken! If you want to use it, please contact me to discuss! In most cases, I will be delighted to discuss your application and walk you through how to use the model.  
